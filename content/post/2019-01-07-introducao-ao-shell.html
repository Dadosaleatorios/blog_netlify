---
title: Introdução ao shell
author: dadosaleatorios
date: '2019-01-09'
slug: introducao-ao-shell
---



<p>Neste post vamos dar uma pausa nos posts de pacotes do R, e vamos aprender a usar o shell, do Linux, para nos ajudar na jornada de Data Scientists. Com esse post vamos nos acostumar com algumas expressões e com a ideia de se escrever comandos na tela preta do sistema.</p>
<p>Todos os comandos neste tutorial foram feitos utilizando um ambiente Linux baseado em Debian.</p>
<div id="arquivos-e-pastas" class="section level1">
<h1>Arquivos e pastas</h1>
<div id="pwd" class="section level2">
<h2>Working directory</h2>
<p>Pra começar, podemos desejar saber “onde estamos”, ou seja, podemos querer descobrir qual nossa pasta de trabalho (working directory). No R, fazemos isso com a função <code>getwd()</code>. No shell, digitamos <code>pwd</code> (<em>print working directory</em>).</p>
<pre class="bash"><code>pwd</code></pre>
</div>
<div id="listar-objetos-numa-pasta" class="section level2">
<h2>Listar objetos numa pasta</h2>
<p>Agora sabendo nos localizar, podemos querer saber o que há na pasta onde estamos, quais são os arquivos que estão lá, as pastas. Para fazer isto, usamos o comando <code>ls</code> (<em>listing</em>).</p>
<pre class="bash"><code>ls</code></pre>
</div>
<div id="diretorio-absoluto-x-diretorio-relativo" class="section level2">
<h2>Diretório absoluto x diretório relativo</h2>
<p>Um diretório absoluto é como a latitude e longitude de um ponto no mapa, ou seja, ele especifica a localização do ponto de onde quer que estejamos nesse mapa. Já o diretório relativo é como se fosse uma localização a partir da nossa localização, como: A partir de onde você está, vá 1km nesta rua. Na prática, o shell irá diferenciar os tipos de diretório da seguinte forma: Se começarmos com /, então será absoluto, se começarmos com o nome da pasta, será um diretório relativo.</p>
<ul>
<li><p>Diretório absoluto:</p>
<pre class="bash"><code>ls /home/user/Shell/Exemplos</code></pre></li>
<li><p>Diretório relativo:</p>
<pre class="bash"><code>ls Exemplos</code></pre></li>
</ul>
</div>
<div id="troca-de-diretorio" class="section level2">
<h2>Troca de diretório</h2>
<p>Para trocar o <em>working directory</em> usamos o comando <code>cd</code> (<em>change directory</em>). Basta apenas colocar o diretório (absoluto ou relativo) para o qual queremos mudar (lembrando que estamos no diretório <a href="#pwd">mostrado acima</a>). Note que o comando <code>cd</code> não printa nada na tela. Para checar que nossa troca de diretório funcionou, inserimos também <code>pwd</code>.</p>
<pre class="bash"><code>cd Exemplos
pwd</code></pre>
<p>Também podemos ir para um diretório acima de onde estamos. Para isso podemos usar o diretório absoluto ou <code>..</code> (O working directory voltou a ser o mostrado na <a href="#pwd">primeira seção</a>). Perceba que, de <em>Shell</em> voltamos para o seu <em>parent directory</em>, que é Materiais.</p>
<pre class="bash"><code>cd ..
pwd</code></pre>
<p>Também há um atalho para a <em>home</em>, que é <code>~</code>. Se escrevermos <code>cd ~</code>, iremos trocar o diretório de trabalho para nossa <em>home</em>.</p>
</div>
<div id="copiar-e-mover-arquivos" class="section level2">
<h2>Copiar e mover arquivos</h2>
<p>Se quisermos copiar um arquivo de uma pasta para outra usamos <code>cp</code> (<em>copy</em>). A sintaxe é: <code>cp arq1 arq2 ... arqn dest1 des2 ... destn</code>, onde <em>arq</em> são os arquivos existentes e <em>dest</em> são os locais (com nome do arquivo) onde os <em>arq</em> serão copiados. Note que precisamos escrever o caminho até o arquivo, se ele não estiver no nosso working directory. Após a cópia pedimos para o Shell mostrar os arquivos na pasta Exemplos.</p>
<pre class="bash"><code>cp ex.txt Exemplos/ex.txt
ls Exemplos</code></pre>
<p>Obs.: Se houver algum arquivo de mesmo nome, <code>cp</code> irá substituí-lo pelo que nós estamos colando.</p>
<p>Para mover um arquivo, utilizamos <code>mv</code> (<em>move</em>), que tem a mesma sintaxe de <code>cp</code>. Este comando também sobrescreve arquivos com mesmo nome. Se houver espaços nos nomes dos arquivos (o que deve ser evitado ao máximo), devemos utilizar aspas simples nos nomes dos arquivos.</p>
</div>
<div id="remover-arquivos-e-pastas" class="section level2">
<h2>Remover arquivos e pastas</h2>
<ul>
<li><p>Para remover arquivos utilizamos <code>rm</code> (<em>remove</em>) seguido pelos nomes dos arquivos a serem removidos. <strong>Atenção</strong>: Para o <em>shell</em> não há lixeira, então os arquivos serão excluídos permamentemente.</p></li>
<li><p>Para remover pastas utilizamos <code>rmdir</code> (<em>remove directory</em>) seguido dos nomes das pastas (as pastas devem estar vazias).</p></li>
</ul>
</div>
<div id="criar-pastas" class="section level2">
<h2>Criar pastas</h2>
<p>Para criar uma nova pasta basta utilizar <code>mkdir</code> (<em>make directory</em>) seguido pelo nome da nova pasta. Se a pasta já existe então obteremos uma mensagem de erro informando que a pasta já existe.</p>
<pre class="bash"><code>mkdir Exemplos/Nova_pasta
ls Exemplos</code></pre>
</div>
</div>
<div id="manipulando-dados" class="section level1">
<h1>Manipulando dados</h1>
<div id="visualizando-arquivos" class="section level2">
<h2>Visualizando arquivos</h2>
<p>Para printar um arquivo na tela utilizamos <code>cat</code> (<em>concatenate</em>) seguido pelo nome do arquivo.</p>
<pre class="bash"><code>cat Exemplos/Exemplo_shell.csv</code></pre>
<p>Uma outra opção é utilizar <code>less</code>. Se o arquivo for muito grande, ele vai ser dividido em páginas. Nessa situação a barra de espaços vai para a próxima página e <em>q</em> fecha a visualização</p>
<pre class="bash"><code>less Exemplos/Exemplo_shell.csv</code></pre>
<p>Caso tenhamos inserido múltiplos arquivos, <em>:n</em> vai para o próximo (<em>next</em>) e <em>:p</em>, para o anterior (<em>preview</em>).</p>
</div>
<div id="help" class="section level2">
<h2>Help</h2>
<p>Para visualizar o manual (<em>help</em>) de algum comando do shell basta digitar: <code>man comando</code>. Para navegar no manual basta seguir o mesmo que em <code>less</code>.</p>
</div>
<div id="head-e-tail" class="section level2">
<h2>Head e tail</h2>
<ul>
<li><p>Para exibir as primeiras 10 linhas (default) de um arquivo, utilizamos <code>head</code> seguido do nome do arquivo.</p>
<pre class="bash"><code>head Exemplos/Exemplo_shell.csv</code></pre>
<p>Para exibir um número de linhas diferente do default, basta utilizar a <em>flag</em> -n, seguida do número de linhas desejado. Para outras opções e possibilidades, veja o manual de <code>head</code>.</p>
<pre class="bash"><code>head -n 5 Exemplos/Exemplo_shell.csv</code></pre>
<p>Se colocarmos um <em>-</em> antes do número 5, o <code>head</code> irá exibir todas as linhas até faltarem 5 linhas para acabar o arquivo.</p></li>
<li><p>Para exibir as últimas 10 linhas (default) de um arquivo, utilizamos <code>tail</code>. Para alterar o número de linhas, o processo é igual ao usado em <code>head</code>.</p>
<pre class="bash"><code>tail -n 4 Exemplos/Exemplo_shell.csv</code></pre>
<p>Para que o tail mostre o arquivo a partir de uma certa linha, basta utilizar um <code>+</code> antes do número. Se queremos exibir o arquivo a partir da linha 7:</p>
<pre class="bash"><code>tail -n +7 Exemplos/Exemplo_shell.csv</code></pre></li>
</ul>
</div>
<div id="selecionar-colunas" class="section level2">
<h2>Selecionar colunas</h2>
<p>Para selecionar colunas de um arquivo, usamos <code>cut</code>. Precisaremos especificar os números das colunas a serem exibidas e qual o caractere utilizado para separar as colunas. Se o delimitador de colunas for ponto e vírgula, devemos utilizar aspas simples no símbolo. Caso o delimitador seja vírgula isso não se faz necessário.</p>
<pre class="bash"><code>cut -f 1-2,4 -d &#39;;&#39; Exemplos/Exemplo_shell.csv</code></pre>
</div>
<div id="selecionar-linhas-de-acordo-com-padrao" class="section level2">
<h2>Selecionar linhas de acordo com padrão</h2>
<p>Usando o comando <code>grep</code> podemos selecionar linhas de acordo com um padrão. Por exemplo, vamos selecionar as linhas de <em>Exemplo_shell.csv</em> que tenham o valor “<em>v1</em>”.</p>
<pre class="bash"><code>grep v1 Exemplos/Exemplo_shell.csv</code></pre>
<div id="flags" class="section level3">
<h3>Flags</h3>
<ul>
<li><code>-c</code>: Printa número de linhas com o padrão.</li>
<li><code>-h</code>: Não printa os nomes dos arquivos (quando há múltiplos arquivos).</li>
<li><code>-i</code>: Trata letras maiúsculas e minúsculas como iguais (<em>ignore case</em>).</li>
<li><code>-n</code>: Printa o número das linhas que apresentam o padrão.</li>
<li><code>-v</code>: Inverte a procura (seleciona linhas que não contêm o padrão).</li>
</ul>
</div>
</div>
<div id="contando-caracteres" class="section level2">
<h2>Contando caracteres</h2>
<p>Com <code>wc</code> (<em>word count</em>) podemos contar o número de linhas, palavras e bytes de um documento.</p>
<pre class="bash"><code>wc Exemplos/Exemplo_shell.csv</code></pre>
<div id="flags-1" class="section level3">
<h3>Flags</h3>
<ul>
<li><code>-c</code>: bytes</li>
<li><code>-m</code>: caracteres.</li>
<li><code>-w</code>: palavras (<em>words</em>).</li>
<li><code>-l</code>: linhas.</li>
</ul>
</div>
</div>
</div>
<div id="combinando-ferramentas" class="section level1">
<h1>Combinando ferramentas</h1>
<div id="salvar-resultado-num-arquivo" class="section level2">
<h2>Salvar resultado num arquivo</h2>
<p>Para salvar o resultado de comandos feitos em um arquivo devemos usar <code>&gt; nome_arquivo</code>. Esse comando pode estar antes ou depois de todos os comandos.</p>
<pre class="bash"><code>head -n 7 Exemplos/Exemplo_shell.csv &gt; Exemplos/saida.csv </code></pre>
<p>O comando acima produz o mesmo resultado que:</p>
<pre class="bash"><code>&gt; Exemplos/saida.csv head -n 7 Exemplos/Exemplo_shell.csv </code></pre>
</div>
<div id="pipe" class="section level2">
<h2>Pipe</h2>
<p>Podemos utilizar a saída de um comando como input para um próximo comando com o pipe - <code>|</code></p>
<pre class="bash"><code>head -n 10 Exemplos/Exemplo_shell.csv | tail -n 5</code></pre>
<p>Assim temos as cinco últimas linhas das dez primeiras linhas do arquivo <code>Exemplo_shell.csv</code>.</p>
</div>
<div id="wildcards" class="section level2">
<h2>Wildcards</h2>
<p>Podemos querer selecionar todos os arquivos em uma pasta para, por exemplo, movê-los, ou simplesmente visualizar quais são os arquivos com extensão csv numa pasta.</p>
<ul>
<li><p>Listando todos os arquivos na pasta Exemplos de extensão csv</p>
<pre class="bash"><code>ls Exemplos/*.csv</code></pre></li>
<li><p>Listando todos os arquivos na pasta Exemplos de extensão csv ou txt</p>
<pre class="bash"><code>ls Exemplos/*.{txt,csv}</code></pre></li>
<li><code>?</code> corresponde a um caractere, então <code>201?.txt</code> corresponderá a <code>2017.txt</code> ou <code>2018.txt</code>, mas não a <code>2017-01.txt</code>.</li>
<li><code>[...]</code> corresponde a qualquer um dos caracteres nos colchetes, então <code>201[78].txt</code> corresponde a <code>2017.txt</code> ou a <code>2018.txt</code>, mas não a <code>2016.txt</code>.</li>
<li><p><code>{...}</code> corresponde a qualquer um dos termos separados por vírgulas, então <code>{*.txt, *.csv}</code> corresponde a todos os arquivos de extensão <code>.txt</code> ou <code>.csv</code>.</p></li>
</ul>
</div>
<div id="ordenacao" class="section level2">
<h2>Ordenação</h2>
<p>Para ordenar, usamos <code>sort</code>.</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f 3 Exemplos/Exemplo_shell.csv | sort</code></pre>
<p>Note que o valor ‘var2’ (nome da coluna) entrou na lista de valores a serem ordenados. Pra resolver isso basta usar o <code>grep</code>.</p>
<div id="flags-2" class="section level3">
<h3>Flags</h3>
<ul>
<li><code>-n</code>: Ordem numérica.</li>
<li><code>-r</code>: Ordem reversa.</li>
</ul>
<pre class="bash"><code>cut -d &#39;;&#39; -f 3 Exemplos/Exemplo_shell.csv | sort -r | grep -v var2</code></pre>
</div>
</div>
<div id="valores-distintos" class="section level2">
<h2>Valores distintos</h2>
<p>Vamos querer saber quais são os valores distintos da terceira coluna do arquivo <code>Exemplo_shell.csv</code>.</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f 3 Exemplos/Exemplo_shell.csv | uniq</code></pre>
<p>Perceba que os valores, no fundo, não são únicos. Isso é porque o <code>uniq</code> reconhece valores como iguais se eles forem seguidos. Para isso precisamos então ordenar os valores antes de buscar os valores distintos. Então para obter, realmente, valores distintos:</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f 3 Exemplos/Exemplo_shell.csv | sort | grep -v var2 | uniq</code></pre>
<div id="flag" class="section level3">
<h3>Flag</h3>
<ul>
<li><code>-c</code>: Adiciona frequência (<em>count</em>).</li>
</ul>
<pre class="bash"><code>cut -d &#39;;&#39; -f 3 Exemplos/Exemplo_shell.csv | sort | grep -v var2 | uniq -c</code></pre>
</div>
</div>
<div id="interromper-comando" class="section level2">
<h2>Interromper comando</h2>
<p>Quando, por algum motivo (possivelmente erro) o shell ficar aguardando inserirmos mais coisas, podemos interromper o processo apenas apertando <em>Ctrl + C</em>.</p>
</div>
<div id="historico" class="section level2">
<h2>Histórico</h2>
<p>Para visualizar uma listagem dos comandos executados anteriormente, basta usar <code>history</code>. Ao digitarmos <code>!</code> + número do comando, ele será rodado novamente.</p>
</div>
</div>
<div id="criando-ferramentas" class="section level1">
<h1>Criando ferramentas</h1>
<div id="variaveis" class="section level2">
<h2>Variáveis</h2>
<p>O shell já tem algumas variáveis globais, que sempre estão disponíveis. Para verificar quais são elas, digitamos <code>set</code>. Daremos um <code>head</code> para não ocupar muito espaço neste tutorial. Em geral, as variáveis são escritas com letras maiúsculas.</p>
<pre class="bash"><code>set | head -n 20</code></pre>
<div id="variaveis-comumente-usadas" class="section level3">
<h3>Variáveis comumente usadas</h3>
<ul>
<li><code>HOME</code>: Diretório home.</li>
<li><code>PWD</code>: Diretório de trabalho atual.</li>
<li><code>SHELL</code>: Programa de shell usado.</li>
<li><code>USER</code>: ID do usuário</li>
</ul>
</div>
<div id="valor-da-variavel" class="section level3">
<h3>Valor da variável</h3>
<p>Para printar o valor da variável, devemos usar <code>echo $nome_variavel</code>. Atenção para o uso de <code>$</code>.</p>
<pre class="bash"><code>echo $SHELL</code></pre>
</div>
</div>
<div id="atribuicao" class="section level2">
<h2>Atribuição</h2>
<p>Para atribuir um valor a uma variável usamos <code>=</code>, sem espaços:</p>
<pre class="bash"><code>v1=1
echo $v1

arquivo=Exemplo_shell.csv
echo $arquivo</code></pre>
<p>Observação: Se o valor a ser atribuído à variável é um string com acento, então o uso de aspas é obrigatório.</p>
</div>
<div id="loop" class="section level2">
<h2>Loop</h2>
<p>Podemos criar também um loop no shell da seguinte forma: <code>for variavel in v1  v2  v3; do comandos; done</code></p>
<pre class="bash"><code>for i in 1 2 3 4 5; do echo $i; done</code></pre>
<p>Os comandos do loop podem conter pipe. Se houver mais de um comando, devemos separar com <code>;</code>. Além disso, os valores em que o índice vai variar podem vir de alguma variável ou de uma sequência, como veremos na próxima seção.</p>
<div id="gerando-sequencia-para-loop" class="section level3">
<h3>Gerando sequência para loop</h3>
<p>Podemos usar o comando <code>seq</code> para criar uma sequência.</p>
<ul>
<li><code>seq</code> 5: Sequência de 1 a 5.</li>
<li><code>seq</code> 2 6: Sequência de 2 a 6.</li>
<li><code>seq</code> 1 2 10: Números ímpares de 1 a 10.</li>
</ul>
<pre class="bash"><code>for i in $(seq 5); do echo $i; done</code></pre>
<p>Também podemos usar o conteúdo de uma pasta, por exemplo:</p>
<pre class="bash"><code>arquivos=Exemplos/*
  
for nome in $arquivos; do echo $nome; done  </code></pre>
</div>
</div>
<div id="scripts" class="section level2">
<h2>Scripts</h2>
<div id="editar-um-arquivo" class="section level3">
<h3>Editar um arquivo</h3>
<p>Para abrir um arquivo em um editor de texto, a fim de editá-lo, usamos o comando <code>nano</code>. O editor não será aberto aqui, portanto, para visualizar o arquivo no editor, você deve digitar este comando no shell (lembrando de adaptar o caminho se você estiver num diretório diferente). Pode ser usado para criar um novo arquivo.</p>
<pre class="bash"><code>nano Exemplos/ex.txt</code></pre>
<div id="atalhos-importantes" class="section level4">
<h4>Atalhos importantes</h4>
<p>Ao editar um arquivo, algumas combinações de teclas são muito importantes, como:</p>
<ul>
<li>Ctrl-K: Deleta uma linha.</li>
<li>Ctrl-U: Faz o <em>un-delete</em> da linha.</li>
<li>Ctrl-O: Salva o arquivo.</li>
<li>Ctrl-X: Fecha o editor.</li>
</ul>
</div>
</div>
<div id="criando-um-script" class="section level3">
<h3>Criando um script</h3>
<p>Para criar um script basta criar um arquivo (de extensão .sh) e digitar comandos neste script. Por exemplo, iremos criar um script que calcula a frequência dos valores da segunda coluna de Exemplo_shell.csv:</p>
<pre class="bash"><code>nano Exemplos/script.sh</code></pre>
<p>Ao abrir o arquivo no editor (ele não abrirá neste relatório), iremos colocar o seguinte comando:</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f 2 Exemplos/Exemplo_shell.csv | grep -v var1 | sort | uniq -c</code></pre>
</div>
<div id="executando-script" class="section level3">
<h3>Executando script</h3>
<p>Para executar o script usamos o comando <code>bash</code>.</p>
<pre class="bash"><code>bash Exemplos/script.sh</code></pre>
</div>
<div id="passando-nomes-de-arquivos-para-scripts" class="section level3">
<h3>Passando nomes de arquivos para scripts</h3>
<p>Podemos também fazer o script receber o nome do arquivo que deve ser trabalhado apenas na hora de rodar o script. Para isso, vamos criar um novo script.</p>
<pre class="bash"><code>nano Exemplos/script2.sh</code></pre>
<p>Neste script colocaremos o seguinte comando:</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f 2 $@ | grep -v var1 | sort | uniq -c</code></pre>
<p>Observe a inclusão de <code>$@</code>, que vai fazer o papel do nome do arquivo.</p>
<p>Para executar este script iremos passar o nome do arquivo. Então:</p>
<pre class="bash"><code>bash Exemplos/script2.sh Exemplos/Exemplo_shell.csv</code></pre>
</div>
<div id="passando-argumentos-para-script" class="section level3">
<h3>Passando argumentos para script</h3>
<p>Para deixar nosso script que calcula frequência mais geral, podemos deixar que se passem argumentos, como o número da coluna selecionada, o nome da coluna (que deve ser retirada no <code>grep</code>), além do nome do arquivo. Iremos criar um terceiro script que receberá três coisas: nome do arquivo, número da coluna e nome da variável (que será retirado).</p>
<pre class="bash"><code>nano Exemplos/script2.sh</code></pre>
<p>Neste script colocaremos o seguinte comando:</p>
<pre class="bash"><code>cut -d &#39;;&#39; -f $2 $1 | grep -v $3 | sort | uniq -c</code></pre>
<p>Perceba que o número após o <code>$</code> será a ordem de entrada dos parâmetros, ou seja, o segundo parâmetro deverá ser o número da coluna que será selecionada. Então, para rodar esse script:</p>
<pre class="bash"><code>bash Exemplos/script3.sh Exemplos/Exemplo_shell.csv 3 var2</code></pre>
</div>
<div id="pipe-apos-script" class="section level3">
<h3>Pipe após script</h3>
<p>É possível também usar o pipe para pegar o output de um script. Vamos selecionar as 10 primeiras linhas do output gerado pelo <em>script2.sh</em>:</p>
<pre class="bash"><code>bash Exemplos/script2.sh Exemplos/Exemplo_shell.csv | head</code></pre>
</div>
<div id="script-com-loop" class="section level3">
<h3>Script com loop</h3>
<p>Veja o <em>script4.sh</em>:</p>
<pre class="bash"><code>cat Exemplos/script4.sh</code></pre>
<p>Perceba que há um loop com três comandos e note também o comentário, com o símbolo #. (a identação dos comandos dentro do loop não é obrigatória)</p>
<pre class="bash"><code>bash Exemplos/script4.sh Exemplos/Exemplo_shell.csv Exemplos/saida.csv</code></pre>
</div>
</div>
</div>
<div id="sugestao-de-leitura" class="section level1">
<h1>Sugestão de leitura</h1>
<p><a href="https://www.shellscript.sh/">Este tutorial</a> temos muito mais informação sobre o shell, que vai além desse tutorial de introdução.</p>
<p><a href="https://www.datacamp.com/courses/introduction-to-shell-for-data-science"><em>Introduction to Shell for Data Science</em></a>, curso do DataCamp, usado como base para este post.</p>
</div>
