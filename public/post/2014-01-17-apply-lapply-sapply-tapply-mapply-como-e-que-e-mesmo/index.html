<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.37.1" />

  <title>apply, lapply, sapply, tapply, mapply.. Como é que é mesmo? &middot; Dados Aleatórios</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  

  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>Sobre</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/contact/"><i class='fa fa-phone fa-fw'></i>Contato</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://twitter.com/dadosaleatorios" target="_blank"><i class="fa fa-twitter-square fa-fw"></i>Twitter</a>
    </li>
    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://facebook.com/dadosaleatorios" target="_blank"><i class="fa fa-facebook-square fa-fw"></i>Facebook</a>
    </li>
    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://instagram.com/*" target="_blank"><i class="fa fa-instagram fa-fw"></i>Instagram</a>
    </li>
    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://linkedin.com/in/*" target="_blank"><i class="fa fa-linkedin-square fa-fw"></i>LinkedIn</a>
    </li>
    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/dadosaleatorios" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://stackoverflow.com/users/*" target="_blank"><i class="fa fa-stack-overflow fa-fw"></i>Stack Overflow</a>
    </li>
    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2016. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>apply, lapply, sapply, tapply, mapply.. Como é que é mesmo?</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>17 Jan 2014, 00:00</time>
  </div>

  

  

  

</div>

  

<p>Acredito que a esta altura do campeonato todos já devem se questionar sobre a performance do R. Existe um Carma que é carregado de que não é eficiente em termos de gerenciamento de memória e velocidade. Tudo bem, temos que cofessar que estes itens não podem ser classificados como os pontos fortes da linguagem, porém nem tudo está perdido e dependendo da situação, contorná-la pode ser mais simples do que parece, em especial quando o assunto é velocidade.</p>

<p>Escrever loops da forma tradicional pode ser uma verdadeira tortura, tanto para o usuário quanto para o computador. Se você já tentou aninhar mais de 3_ for&rsquo;s_ sabe do que estou falando. Claro que não existe uma ferramenta mágica que vai fazer com que seu loop passe de 2 horas paras 5 segundos, porém com as metafunções da família_ apply_ muita coisa pode ser melhorada. As funções da família <em>apply</em> são um conjunto muito poderoso de funções que sob certas condições permitem a aplicação de outras funções em objetos do R .</p>

<p>Algumas vezes as funções que são utilizadas junto das funções apply são conhecidas como funções anônimas. Isto significa que elas são definidas apenas no contexto do apply e uma vez feito isso, não farão parte do ambiente global. Um exemplo é exibido quando a função lapply é abordada.</p>

<h4 id="apply">apply</h4>

<p>Aplica uma função nas margens de um array qualquer. Geralmente é aplicado em uma matriz/dataframe de forma a aplicar uma mesma função em todas as linhas ou colunas daquele objeto. Recebe como argumento um array, a marginal sobre a qual a função será aplicada e a função.</p>

<pre><code class="language-r"> # apply.R&lt;br&gt;&lt;/br&gt;X = matrix(rnorm(200), ncol=20) # matriz com 20 colunas e 10 linhas&lt;br&gt;&lt;/br&gt;media_linha = apply(X, 1, mean) # média por linha&lt;br&gt;&lt;/br&gt; [1]  0.04379803  0.16120193  0.18021305 -0.24121940  0.25072885 -0.35231844&lt;br&gt;&lt;/br&gt; [7]  0.06052024  0.17069682 -0.11181799  0.04517407&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;
</code></pre>

<p>Casos Especiais: As funções rowSums, rowMeans, rowSums e colMeans podem ser facilmente substituídas por uma função apply (por exemplo, <em>rowSums(X) = apply(X,1, sum)</em> ), porém no caso destas tarefas em particular, estas funções são super otimizadas.</p>

<p>Obs.: É importante lembrar que em termos de velocidade a função apply não supera tanto um loop normal, mas só o fato de poder escrever o loop em uma linha já é um bom motivo para usá-lo sempre que puder.</p>

<h4 id="lapply">lapply</h4>

<p>É uma função que é aplicada em cada elemento de um vetor ou cada nó de uma lista. O output é uma lista obrigatoriamente. Recebe como argumentos um vetor/lista e uma função.</p>

<pre><code class="language-r"> # lapply.R&lt;br&gt;&lt;/br&gt;X = list(x1=c(1,2,NA,4,5), x2=rnorm(100), x3=rnorm(100) )&lt;br&gt;&lt;/br&gt;lapply(X, mean)&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$x1&lt;br&gt;&lt;/br&gt;[1] NA&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$x2&lt;br&gt;&lt;/br&gt;[1] -0.1908649&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;$x3&lt;br&gt;&lt;/br&gt;[1] -0.1315371&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;
</code></pre>

<p>Como podem ver, a saída é uma lista e o nó <em>x1</em> ficou com <em>NA.</em> O resultado é claro, uma vez que a função <em>mean</em> por padrão não trata os valores faltantes. Para resolver isto, existem 2 caminhos. O primeiro é declarar a função anônima que foi citada anteriormente, e isto significa definir uma nova função com os argumentos alterados dentro do próprio <em>lapply</em>, e neste caso ficaria  <strong>lapply(X, function(x) mean(x, na.rm=T) ) .</strong> A outra solução é passar os argumentos via &ldquo;&hellip;&rdquo; da função lapply e neste caso a solução seria <strong>lapply(X, mean, na.rm=T)</strong> .</p>

<h4 id="sapply">sapply</h4>

<p>Similar ao lapply, porém a saída geralmente é simplificada, sendo apenas um vetor. Caso sua saída seja mais de um elemento, a saída deixa de ser um vetor e passa a ser uma matriz. Recebe como argumentos um vetor/lista e uma função. A diferença para o <em>lapply</em> é que o <em>sapply</em> tenta simplificar o resultado, retornando assim um vetor ou algo parecido.</p>

<pre><code class="language-r"> # sapply.R&lt;br&gt;&lt;/br&gt;sapply(X, function(x)mean(x, na.rm=T) ) # Cálculo da média de cada elemento da lista via função anônima.&lt;br&gt;&lt;/br&gt;
</code></pre>

<h4 id="tapply">tapply</h4>

<p>Função com o objetivo de aplicar funções em grupos diferentes. Suponha que você tenha um dataframe com 2 colunas, uma com altura e outra com gênero, e você queira calcula a média de idade para cada um dos gẽneros, então neste caso a função tapply se aplica perfeitamente. Recebe como argumentos um vetor, um vetor com os fatores que irão estratificar o resultado e a função a ser aplicada em cada estrato.</p>

<pre><code class="language-r"> # tapply.R&lt;br&gt;&lt;/br&gt;X = rnorm(100) &lt;br&gt;&lt;/br&gt;fator = sample(factor(c('a', 'b')), 100, rep=T) &lt;br&gt;&lt;/br&gt;tapply(X, fator, mean) # A média dos valores por categoria&lt;br&gt;&lt;/br&gt;          a           b &lt;br&gt;&lt;/br&gt;-0.08495240 -0.06317896 &lt;br&gt;&lt;/br&gt;
</code></pre>

<h4 id="mapply">mapply</h4>

<p>É bem provável que seja a função da família apply menos utilizada, porém também tem sua importância na utilização do R. Esta é uma versão multivariada do _sapply _e recebe como argumentos uma função e um conjunto de argumentos. A função é aplicada em cada um dos argumentos sequencialmente.</p>

<pre><code class="language-r"> # mapply.R&lt;br&gt;&lt;/br&gt;mapply(rep, 1:4, 4:1)&lt;br&gt;&lt;/br&gt;[[1]]&lt;br&gt;&lt;/br&gt;[1] 1 1 1 1&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;[[2]]&lt;br&gt;&lt;/br&gt;[1] 2 2 2&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;[[3]]&lt;br&gt;&lt;/br&gt;[1] 3 3&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;[[4]]&lt;br&gt;&lt;/br&gt;[1] 4&lt;br&gt;&lt;/br&gt;&lt;br&gt;&lt;/br&gt;
</code></pre>

<p>No caso do exemplo acima, seria o mesmo que fazer** list(rep(1,4), rep(2,3), rep(3,2), rep(4,1)) **.</p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/post/2014-01-14-entendendo-as-diferentes-mensagens-de-aviso-no-r/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/post/2014-01-14-entendendo-as-diferentes-mensagens-de-aviso-no-r/">Entendendo as diferentes mensagens de aviso no R</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/2014-01-31-afinal-quanto-ganha-um-cientista-de-dados/">Afinal, quanto ganha um cientista de dados?</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/2014-01-31-afinal-quanto-ganha-um-cientista-de-dados/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="/js/ui.js"></script>






</body>
</html>

